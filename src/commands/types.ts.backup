/**
 * TypeScript type definitions for all Tauri commands
 * 
 * These types match the Rust types in src-tauri/src/commands.rs
 * All types use camelCase to match Rust's serde rename_all = "camelCase"
 */

// ============================================================================
// Dashboard Types
// ============================================================================

export interface DashboardKpis {
  totalJobsTracked: number;
  totalApplications: number;
  activeApplications: number;
  applicationsLast30Days: number;
  offersReceived: number;
}

export interface StatusBucket {
  status: string;
  count: number;
}

export interface DailyActivityPoint {
  date: string;
  applicationsCreated: number;
  interviewsCompleted: number;
  offersReceived: number;
}

export interface FunnelStep {
  label: string;
  count: number;
}

export interface DashboardData {
  kpis: DashboardKpis;
  statusBreakdown: StatusBucket[];
  activityLast30Days: DailyActivityPoint[];
  funnel: FunnelStep[];
}

// ============================================================================
// User Profile Types
// ============================================================================

export interface UserProfile {
  id?: number;
  fullName: string;
  headline?: string;
  location?: string;
  summary?: string;
  currentRoleTitle?: string;
  currentCompany?: string;
  seniority?: string;
  openToRoles?: string;
  createdAt?: string;
  updatedAt?: string;
}

export interface Experience {
  id?: number;
  company: string;
  title: string;
  location?: string;
  startDate?: string;
  endDate?: string;
  isCurrent: boolean;
  description?: string;
  achievements?: string;
  techStack?: string;
}

export interface Skill {
  id?: number;
  name: string;
  category?: string;
  selfRating?: number;
  priority?: string;
  yearsExperience?: number;
  notes?: string;
}

export interface Education {
  id?: number;
  institution: string;
  degree?: string;
  fieldOfStudy?: string;
  startDate?: string;
  endDate?: string;
  grade?: string;
  description?: string;
}

export interface Certification {
  id?: number;
  name: string;
  issuingOrganization?: string;
  issueDate?: string;
  expirationDate?: string;
  credentialId?: string;
  credentialUrl?: string;
}

export interface PortfolioItem {
  id?: number;
  title: string;
  url?: string;
  description?: string;
  role?: string;
  techStack?: string;
  highlighted: boolean;
}

export interface UserProfileData {
  profile: UserProfile | null;
  experience: Experience[];
  skills: Skill[];
  education: Education[];
  certifications: Certification[];
  portfolio: PortfolioItem[];
}

// ============================================================================
// Job Types
// ============================================================================

export interface Job {
  id?: number;
  title?: string;
  company?: string;
  location?: string;
  jobSource?: string;
  postingUrl?: string;
  rawDescription?: string;
  parsedJson?: string;
  seniority?: string;
  domainTags?: string;
  isActive: boolean;
  dateAdded: string;
  lastUpdated: string;
}

export interface JobSummary {
  id: number;
  title?: string;
  company?: string;
  location?: string;
  seniority?: string;
  domainTags?: string;
  dateAdded: string;
}

export interface CreateJobInput {
  title?: string;
  company?: string;
  location?: string;
  jobSource?: string;
  postingUrl?: string;
  rawDescription?: string;
}

export interface UpdateJobInput {
  title?: string;
  company?: string;
  location?: string;
  jobSource?: string;
  postingUrl?: string;
  rawDescription?: string;
  isActive?: boolean;
}

export interface ParsedJob {
  titleSuggestion?: string | null;
  companySuggestion?: string | null;
  seniority?: string | null;
  location?: string | null;
  summary?: string | null;
  responsibilities: string[];
  requiredSkills: string[];
  niceToHaveSkills: string[];
  domainTags: string[];
  seniorityScore?: number | null;
  remoteFriendly?: boolean | null;
}

// ============================================================================
// Application Types
// ============================================================================

export type ApplicationStatus =
  | "Saved"
  | "Draft"
  | "Applied"
  | "Interviewing"
  | "Offer"
  | "Rejected"
  | "Ghosted"
  | "Withdrawn";

export interface Application {
  id?: number;
  jobId: number;
  status: ApplicationStatus;
  channel?: string;
  priority?: "Low" | "Medium" | "High" | "Dream";
  dateSaved: string;
  dateApplied?: string;
  lastActivityDate?: string;
  nextActionDate?: string;
  nextActionNote?: string;
  notesSummary?: string;
  contactName?: string;
  contactEmail?: string;
  contactLinkedin?: string;
  locationOverride?: string;
  offerCompensation?: string;
  archived: boolean;
  createdAt: string;
  updatedAt: string;
}

export interface ApplicationSummary {
  id: number;
  jobId: number;
  jobTitle?: string;
  company?: string;
  status: ApplicationStatus;
  priority?: "Low" | "Medium" | "High" | "Dream";
  dateSaved: string;
  dateApplied?: string;
  lastActivityDate?: string;
}

export interface ApplicationEvent {
  id?: number;
  applicationId: number;
  eventType: string;
  eventDate: string;
  fromStatus?: string;
  toStatus?: string;
  title?: string;
  details?: string;
  createdAt: string;
}

export interface ApplicationDetail {
  application: Application;
  events: ApplicationEvent[];
}

// ============================================================================
// Calendar Types
// ============================================================================

export interface CalendarEvent {
  id?: number;
  applicationId: number;
  jobTitle?: string;
  company?: string;
  eventType: string;
  eventDate: string;
  title?: string;
  details?: string;
  nextActionDate?: string;
  nextActionNote?: string;
}

export interface CreateApplicationInput {
  jobId: number;
  status?: ApplicationStatus;
  channel?: string;
  priority?: "Low" | "Medium" | "High" | "Dream";
}

export interface UpdateApplicationInput {
  status?: ApplicationStatus;
  channel?: string;
  priority?: "Low" | "Medium" | "High" | "Dream";
  dateApplied?: string;
  nextActionDate?: string;
  nextActionNote?: string;
  notesSummary?: string;
  contactName?: string;
  contactEmail?: string;
  contactLinkedin?: string;
  locationOverride?: string;
  offerCompensation?: string;
}

export interface AddEventInput {
  applicationId: number;
  eventType: string;
  eventDate: string;
  fromStatus?: string;
  toStatus?: string;
  title?: string;
  details?: string;
}

// ============================================================================
// Resume & Cover Letter Types
// ============================================================================

export interface ResumeSection {
  title: string;
  items: ResumeSectionItem[];
}

export interface ResumeSectionItem {
  heading: string;
  subheading?: string;
  bullets: string[];
}

export interface GeneratedResume {
  summary?: string;
  headline?: string;
  sections: ResumeSection[];
  highlights: string[];
}

export interface GeneratedLetter {
  subject?: string;
  greeting?: string;
  bodyParagraphs: string[];
  closing?: string;
  signature?: string;
}

export interface GenerationOptions {
  tone?: string;
  length?: string;
  focus?: string;
  audience?: string; // For cover letters
}

export interface ResumeGenerationResult {
  resume: GeneratedResume;
  content: string;
}

export interface LetterGenerationResult {
  letter: GeneratedLetter;
  content: string;
}

// ============================================================================
// Artifact Types
// ============================================================================

export interface Artifact {
  id: number;
  jobId?: number;
  applicationId?: number;
  type: "resume" | "cover_letter" | "notes" | "other";
  title: string;
  content?: string;
  filePath?: string;
  createdAt: string;
  updatedAt: string;
}

export interface SaveResumeInput {
  jobId: number;
  applicationId?: number;
  title: string;
  resume: GeneratedResume;
  content: string;
}

export interface SaveCoverLetterInput {
  jobId: number;
  applicationId?: number;
  title: string;
  letter: GeneratedLetter;
  content: string;
}

// ============================================================================
// Tauri Command Type Definitions
// ============================================================================

/**
 * Type-safe wrapper for Tauri invoke calls
 * 
 * Usage:
 * ```typescript
 * import { invoke } from '@tauri-apps/api/core';
 * import type { Commands } from './commands/types';
 * 
 * const data = await invoke<Commands['get_dashboard_data']['return']>('get_dashboard_data');
 * ```
 */

export interface Commands {
  // Dashboard
  get_dashboard_data: {
    args: [];
    return: DashboardData;
  };

  // User Profile
  get_user_profile_data: {
    args: [];
    return: UserProfileData;
  };
  save_user_profile_data: {
    args: [data: UserProfileData];
    return: UserProfileData;
  };

  // Jobs
  create_job: {
    args: [input: CreateJobInput];
    return: Job;
  };
  update_job: {
    args: [id: number, input: UpdateJobInput];
    return: Job;
  };
  get_job_list: {
    args: [options?: { search?: string | null; activeOnly?: boolean; source?: string | null }];
    return: JobSummary[];
  };
  get_job_detail: {
    args: [id: number];
    return: Job;
  };
  parse_job_with_ai: {
    args: [jobId: number];
    return: ParsedJob;
  };

  // Applications
  create_application: {
    args: [input: CreateApplicationInput];
    return: Application;
  };
  update_application: {
    args: [id: number, input: UpdateApplicationInput];
    return: Application;
  };
  get_applications: {
    args: [options?: { status?: ApplicationStatus | null; jobId?: number | null; activeOnly?: boolean }];
    return: ApplicationSummary[];
  };
  get_application_detail: {
    args: [id: number];
    return: ApplicationDetail;
  };
  add_application_event: {
    args: [input: AddEventInput];
    return: ApplicationEvent;
  };
  archive_application: {
    args: [id: number];
    return: Application;
  };

  // Resume & Cover Letter Generation
  generate_resume_for_job: {
    args: [jobId: number, applicationId?: number | null, options?: GenerationOptions];
    return: ResumeGenerationResult;
  };
  generate_cover_letter_for_job: {
    args: [jobId: number, applicationId?: number | null, options?: GenerationOptions];
    return: LetterGenerationResult;
  };
  save_resume: {
    args: [input: SaveResumeInput];
    return: Artifact;
  };
  save_cover_letter: {
    args: [input: SaveCoverLetterInput];
    return: Artifact;
  };
  update_artifact_title: {
    args: [id: number, title: string];
    return: Artifact;
  };

  // AI Settings
  get_ai_settings: {
    args: [];
    return: import('../ai/types').AiSettings;
  };
  save_ai_settings: {
    args: [settings: import('../ai/types').AiSettings];
    return: void;
  };
  test_ai_connection: {
    args: [];
    return: string;
  };
  check_local_provider_availability: {
    args: [];
    return: boolean;
  };

  // AI Operations (lower-level)
  ai_resume_suggestions: {
    args: [input: import('../ai/types').ResumeInput];
    return: import('../ai/types').ResumeSuggestions;
  };
  ai_cover_letter: {
    args: [input: import('../ai/types').CoverLetterInput];
    return: import('../ai/types').CoverLetter;
  };
  ai_skill_suggestions: {
    args: [input: import('../ai/types').SkillSuggestionsInput];
    return: import('../ai/types').SkillSuggestions;
  };

  // Profile AI Enhancements
  generate_profile_summary: {
    args: [];
    return: string;
  };
  extract_skills_from_experience: {
    args: [];
    return: string[];
  };
  rewrite_portfolio_description: {
    args: [portfolioId: number, description: string];
    return: string;
  };

  // Calendar
  get_calendar_events: {
    args: [startDate: string, endDate: string];
    return: CalendarEvent[];
  };
  get_events_for_date: {
    args: [date: string];
    return: CalendarEvent[];
  };
  sync_interview_to_calendar: {
    args: [
      applicationId: number,
      eventId: number | null,
      title: string,
      startTime: string,
      endTime: string | null,
      location: string | null,
      notes: string | null
    ];
    return: string; // ICS file content or sync confirmation
  };

  // Reminders
  create_reminder: {
    args: [
      applicationId: number | null,
      eventId: number | null,
      reminderType: string,
      reminderDate: string,
      message: string | null
    ];
    return: number; // reminder ID
  };
  get_reminders: {
    args: [startDate: string, endDate: string, includeSent: boolean];
    return: Reminder[];
  };
  get_due_reminders: {
    args: [];
    return: Reminder[];
  };
  get_reminders_for_application: {
    args: [applicationId: number];
    return: Reminder[];
  };
  mark_reminder_sent: {
    args: [reminderId: number];
    return: void;
  };
  delete_reminder: {
    args: [reminderId: number];
    return: void;
  };

  // Email Integration
  save_email_account: {
    args: [account: EmailAccount];
    return: number;
  };
  get_email_accounts: {
    args: [];
    return: EmailAccount[];
  };
  delete_email_account: {
    args: [accountId: number];
    return: void;
  };
  get_email_threads_for_application: {
    args: [applicationId: number];
    return: EmailThread[];
  };
  link_email_thread_to_application: {
    args: [threadId: number, applicationId: number];
    return: void;
  };
  get_email_messages_for_thread: {
    args: [threadId: number];
    return: EmailMessage[];
  };
  test_email_connection: {
    args: [email: string, password: string, provider: string];
    return: string;
  };
  sync_email_account: {
    args: [accountId: number];
    return: string;
  };

  // Learning Plans
  analyze_skill_gaps: {
    args: [jobId: number | null, includeAllJobs: boolean];
    return: SkillGap[];
  };
  create_learning_plan: {
    args: [
      title: string,
      description: string | null,
      targetJobId: number | null,
      skillGaps: SkillGap[],
      estimatedDurationDays: number | null
    ];
    return: number; // plan ID
  };
  get_learning_plans: {
    args: [status: string | null];
    return: LearningPlan[];
  };
  get_learning_tracks: {
    args: [learningPlanId: number];
    return: LearningTrack[];
  };
  get_learning_tasks: {
    args: [learningTrackId: number];
    return: LearningTask[];
  };
  create_learning_track: {
    args: [
      learningPlanId: number,
      title: string,
      description: string | null,
      skillFocus: string | null,
      orderIndex: number
    ];
    return: number; // track ID
  };
  create_learning_task: {
    args: [
      learningTrackId: number,
      title: string,
      description: string | null,
      taskType: string,
      resourceUrl: string | null,
      estimatedHours: number | null,
      dueDate: string | null,
      orderIndex: number
    ];
    return: number; // task ID
  };
  complete_learning_task: {
    args: [taskId: number, completed: boolean];
    return: void;
  };
  add_learning_resource: {
    args: [
      learningTaskId: number | null,
      title: string,
      url: string | null,
      resourceType: string,
      description: string | null
    ];
    return: number; // resource ID
  };
  get_learning_resources: {
    args: [learningTaskId: number];
    return: LearningResource[];
  };
  delete_learning_plan: {
    args: [planId: number];
    return: void;
  };
  update_learning_plan_status: {
    args: [planId: number, status: string];
    return: void;
  };
  generate_learning_content: {
    args: [learningPlanId: number, skillGaps: SkillGap[]];
    return: void;
  };

  // Recruiter CRM
  create_recruiter_contact: {
    args: [
      name: string,
      email: string | null,
      phone: string | null,
      linkedinUrl: string | null,
      company: string | null,
      title: string | null,
      notes: string | null,
      relationshipStrength: string | null,
      tags: string | null
    ];
    return: number; // contact ID
  };
  get_recruiter_contacts: {
    args: [companyFilter: string | null, searchQuery: string | null];
    return: RecruiterContact[];
  };
  get_recruiter_contact: {
    args: [contactId: number];
    return: RecruiterContact;
  };
  update_recruiter_contact: {
    args: [
      contactId: number,
      name: string | null,
      email: string | null,
      phone: string | null,
      linkedinUrl: string | null,
      company: string | null,
      title: string | null,
      notes: string | null,
      relationshipStrength: string | null,
      tags: string | null
    ];
    return: void;
  };
  delete_recruiter_contact: {
    args: [contactId: number];
    return: void;
  };
  create_interaction: {
    args: [
      contactId: number,
      interactionType: string,
      interactionDate: string,
      subject: string | null,
      notes: string | null,
      linkedApplicationId: number | null,
      linkedJobId: number | null,
      outcome: string | null,
      followUpDate: string | null
    ];
    return: number; // interaction ID
  };
  get_interactions_for_contact: {
    args: [contactId: number];
    return: RecruiterInteraction[];
  };
  get_interactions_for_application: {
    args: [applicationId: number];
    return: RecruiterInteraction[];
  };
  link_contact_to_application: {
    args: [contactId: number, applicationId: number, role: string | null, notes: string | null];
    return: number; // link ID
  };
  get_contacts_for_application: {
    args: [applicationId: number];
    return: RecruiterContact[];
  };
  get_applications_for_contact: {
    args: [contactId: number];
    return: number[];
  };
  unlink_contact_from_application: {
    args: [contactId: number, applicationId: number];
    return: void;
  };
  delete_interaction: {
    args: [interactionId: number];
    return: void;
  };

  // Cache Management
  get_cache_stats: {
    args: [];
    return: CacheStats;
  };
  clear_cache_by_purpose: {
    args: [purpose: string];
    return: number; // count of deleted entries
  };
  clear_all_cache: {
    args: [];
    return: number; // count of deleted entries
  };
  cleanup_expired_cache: {
    args: [];
    return: number; // count of deleted entries
  };
  evict_cache_by_size: {
    args: [maxSizeMb: number];
    return: number; // count of evicted entries
  };
  evict_cache_by_count: {
    args: [maxEntries: number];
    return: number; // count of evicted entries
  };
}

// ============================================================================
// Reminder Types
// ============================================================================

export interface Reminder {
  id?: number;
  applicationId?: number;
  eventId?: number;
  reminderType: string;
  reminderDate: string;
  message?: string;
  isSent: boolean;
  sentAt?: string;
  createdAt: string;
}

// ============================================================================
// Email Types
// ============================================================================

export interface EmailAccount {
  id?: number;
  emailAddress: string;
  provider: string;
  imapServer?: string;
  imapPort?: number;
  smtpServer?: string;
  smtpPort?: number;
  useSsl: boolean;
  isActive: boolean;
  lastSyncAt?: string;
  createdAt: string;
  updatedAt: string;
}

export interface EmailThread {
  id?: number;
  applicationId?: number;
  threadId: string;
  subject?: string;
  participants?: string;
  lastMessageDate?: string;
  messageCount: number;
  isArchived: boolean;
  createdAt: string;
  updatedAt: string;
}

export interface EmailMessage {
  id?: number;
  threadId: number;
  emailAccountId: number;
  messageId: string;
  fromAddress?: string;
  toAddress?: string;
  subject?: string;
  bodyText?: string;
  bodyHtml?: string;
  receivedDate: string;
  isRead: boolean;
  isApplicationEvent: boolean;
  eventType?: string;
  extractedData?: string;
  createdAt: string;
}

// ============================================================================
// Learning Plan Types
// ============================================================================

export interface SkillGap {
  skill: string;
  frequency: number;
  priority: "high" | "medium" | "low";
  userHasSkill: boolean;
  userRating?: number;
}

export interface LearningPlan {
  id?: number;
  title: string;
  description?: string;
  targetJobId?: number;
  skillGaps?: string; // JSON string
  estimatedDurationDays?: number;
  status: string;
  createdAt: string;
  updatedAt: string;
}

export interface LearningTrack {
  id?: number;
  learningPlanId: number;
  title: string;
  description?: string;
  skillFocus?: string;
  orderIndex: number;
  createdAt: string;
}

export interface LearningTask {
  id?: number;
  learningTrackId: number;
  title: string;
  description?: string;
  taskType: string;
  resourceUrl?: string;
  estimatedHours?: number;
  completed: boolean;
  completedAt?: string;
  dueDate?: string;
  orderIndex: number;
  createdAt: string;
  updatedAt: string;
}

export interface LearningResource {
  id?: number;
  learningTaskId?: number;
  title: string;
  url?: string;
  resourceType: string;
  description?: string;
  createdAt: string;
}

// ============================================================================
// Recruiter CRM Types
// ============================================================================

export interface RecruiterContact {
  id?: number;
  name: string;
  email?: string;
  phone?: string;
  linkedinUrl?: string;
  company?: string;
  title?: string;
  notes?: string;
  relationshipStrength: string;
  lastContactDate?: string;
  tags?: string;
  createdAt: string;
  updatedAt: string;
}

export interface RecruiterInteraction {
  id?: number;
  contactId: number;
  interactionType: string;
  interactionDate: string;
  subject?: string;
  notes?: string;
  linkedApplicationId?: number;
  linkedJobId?: number;
  outcome?: string;
  followUpDate?: string;
  createdAt: string;
}

export interface ContactApplicationLink {
  id?: number;
  contactId: number;
  applicationId: number;
  role?: string;
  notes?: string;
  createdAt: string;
}

// ============================================================================
// Companies Types
// ============================================================================

export interface Company {
  id?: number;
  name: string;
  website?: string;
  industry?: string;
  companySize?: string;
  location?: string;
  description?: string;
  mission?: string;
  vision?: string;
  values?: string;
  notes?: string;
  createdAt: string;
  updatedAt: string;
}

export interface CompanyWithStats extends Company {
  jobCount: number;
  applicationCount: number;
}

// ============================================================================
// Cache Management Types
// ============================================================================

export interface CacheStats {
  totalEntries: number;
  totalSizeBytes: number;
  entriesByPurpose: Record<string, number>;
  expiredEntries: number;
  oldestEntry?: string;
  newestEntry?: string;
}

/**
 * Helper type to extract return type of a command
 */
export type CommandReturn<T extends keyof Commands> = Commands[T]['return'];

/**
 * Helper type to extract args type of a command
 */
export type CommandArgs<T extends keyof Commands> = Commands[T]['args'];

